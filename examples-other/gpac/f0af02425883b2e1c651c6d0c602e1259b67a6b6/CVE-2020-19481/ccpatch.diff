diff --git a/src/media_tools/mpegts.c b/src/media_tools/mpegts.c
index ef709fb12..cd55e5843 100644
--- a/src/media_tools/mpegts.c
+++ b/src/media_tools/mpegts.c
@@ -1217,6 +1217,11 @@ static void gf_m2ts_process_pmt(GF_M2TS_Demuxer *ts, GF_M2TS_SECTION_ES *pmt, GF
 		Bool inherit_pcr = 0;
 		u32 pid, stream_type, reg_desc_format;
 
+		if (pos + 5 > data_size) {
+			GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("Broken PMT! size %d but position %d and need at least 5 bytes to declare es\n", data_size, pos));
+			break;
+		}
+
 		stream_type = data[0];
 		pid = ((data[1] & 0x1f) << 8) | data[2];
 		desc_len = ((data[3] & 0xf) << 8) | data[4];
@@ -1354,6 +1359,10 @@ static void gf_m2ts_process_pmt(GF_M2TS_Demuxer *ts, GF_M2TS_SECTION_ES *pmt, GF
 		data += 5;
 
 		while (desc_len) {
+			if (pos + 2 > data_size) {
+				GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("Broken PMT descriptor! size %d but position %d and need at least 2 bytes to parse descritpor\n", data_size, pos));
+				break;
+			}
 			u8 tag = data[0];
 			u32 len = data[1];
 			if (es) {
@@ -1525,14 +1534,14 @@ static void gf_m2ts_process_pmt(GF_M2TS_Demuxer *ts, GF_M2TS_SECTION_ES *pmt, GF
 			if (!(es->flags & GF_M2TS_ES_IS_SECTION) ) gf_m2ts_set_pes_framing(pes, GF_M2TS_PES_FRAMING_SKIP);
 
 			nb_es++;
-
-			if (es->stream_type == GF_M2TS_VIDEO_HEVC) nb_hevc++;
-			else if (es->stream_type == GF_M2TS_VIDEO_HEVC_TEMPORAL) nb_hevc_temp++;
-			else if (es->stream_type == GF_M2TS_VIDEO_SHVC) nb_shvc++;
-			else if (es->stream_type == GF_M2TS_VIDEO_SHVC_TEMPORAL) nb_shvc_temp++;
-			else if (es->stream_type == GF_M2TS_VIDEO_MHVC) nb_mhvc++;
-			else if (es->stream_type == GF_M2TS_VIDEO_MHVC_TEMPORAL) nb_mhvc_temp++;
 		}
+
+		if (es->stream_type == GF_M2TS_VIDEO_HEVC) nb_hevc++;
+		else if (es->stream_type == GF_M2TS_VIDEO_HEVC_TEMPORAL) nb_hevc_temp++;
+		else if (es->stream_type == GF_M2TS_VIDEO_SHVC) nb_shvc++;
+		else if (es->stream_type == GF_M2TS_VIDEO_SHVC_TEMPORAL) nb_shvc_temp++;
+		else if (es->stream_type == GF_M2TS_VIDEO_MHVC) nb_mhvc++;
+		else if (es->stream_type == GF_M2TS_VIDEO_MHVC_TEMPORAL) nb_mhvc_temp++;
 	}
 
 	//Table 2-139, implied hierarchy indexes
